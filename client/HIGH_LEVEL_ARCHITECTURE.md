# ğŸ—ï¸ Stellar Escrow DAO - High-Level Architecture

## ğŸ“‹ System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STELLAR ESCROW DAO PLATFORM                   â”‚
â”‚                  Decentralized Freelance Marketplace             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Core Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚â”€â”€â”€â”€â–¶â”‚   Stellar    â”‚â”€â”€â”€â”€â–¶â”‚   Supabase   â”‚
â”‚   (Next.js)  â”‚     â”‚   Network    â”‚     â”‚  (Database)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚Freighterâ”‚          â”‚ Escrow â”‚           â”‚ Disputeâ”‚
   â”‚ Wallet  â”‚          â”‚Accountsâ”‚           â”‚  Data  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›ï¸ Three-Layer Architecture

### 1ï¸âƒ£ **Presentation Layer** (Frontend)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Next.js 15 App                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Components:                                             â”‚
â”‚  â”œâ”€ FreelancerDashboard  (Manage gigs)                  â”‚
â”‚  â”œâ”€ ClientDashboard      (Post jobs)                    â”‚
â”‚  â”œâ”€ ArbitratorDashboard  (Vote on disputes)             â”‚
â”‚  â””â”€ DisputeResolution    (DAO voting)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI/UX:                                                  â”‚
â”‚  â”œâ”€ Framer Motion        (Animations)                   â”‚
â”‚  â”œâ”€ Shadcn UI            (Components)                   â”‚
â”‚  â”œâ”€ Tailwind CSS         (Styling)                      â”‚
â”‚  â””â”€ Dark Purple Theme    (Design)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ **Business Logic Layer** (Client-Side)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Core Libraries                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  src/lib/                                                â”‚
â”‚  â”œâ”€ stellar.ts      â†’ Stellar SDK integration           â”‚
â”‚  â”œâ”€ escrow.ts       â†’ Escrow account management         â”‚
â”‚  â”œâ”€ wallet.ts       â†’ Freighter wallet connection       â”‚
â”‚  â”œâ”€ dao.ts          â†’ DAO voting logic                  â”‚
â”‚  â”œâ”€ storage.ts      â†’ Job data management               â”‚
â”‚  â”œâ”€ disputeStorage.ts â†’ Dispute management              â”‚
â”‚  â””â”€ supabase.ts     â†’ Database client                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Contexts:                                               â”‚
â”‚  â”œâ”€ WalletContext   â†’ Wallet state management           â”‚
â”‚  â”œâ”€ JobContext      â†’ Job state management              â”‚
â”‚  â””â”€ DisputeContext  â†’ Dispute state management          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3ï¸âƒ£ **Data & Blockchain Layer**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Stellar Network (Testnet)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ User Accounts     (Client, Freelancer, Arbitrator)  â”‚
â”‚  â”œâ”€ Escrow Accounts   (Temporary accounts holding XLM)  â”‚
â”‚  â””â”€ Transactions      (Payments, account creation)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Supabase Database                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tables:                                                 â”‚
â”‚  â”œâ”€ disputes         (Dispute records & votes)           â”‚
â”‚  â””â”€ escrow_keys      (Escrow secrets for cross-browser) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Browser Storage                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  localStorage:                                           â”‚
â”‚  â”œâ”€ jobs             (Job listings)                      â”‚
â”‚  â”œâ”€ disputes         (Fallback if no Supabase)          â”‚
â”‚  â””â”€ escrow_keys      (Backup escrow secrets)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Complete User Flow Diagrams

### ğŸ“ Flow 1: Create Job (Client)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚
â”‚ Wallet  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. Connect Wallet
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ClientDashboard â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. Click "Create Job"
     â”‚    - Enter freelancer address
     â”‚    - Enter amount (XLM)
     â”‚    - Enter description
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CreateJobSectionâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. Submit Form
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ escrow.ts       â”‚
â”‚ createRealEscrowâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 4. Generate escrow keypair
     â”‚    escrowKeypair = Keypair.random()
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build TX        â”‚
â”‚ - CreateAccount â”‚
â”‚ - Fund with XLM â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 5. Request signature
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Freighter       â”‚
â”‚ Wallet Popup    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 6. User approves
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stellar Network â”‚
â”‚ Submit TX       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 7. Escrow account created
     â”‚    Funds locked on-chain
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Store Data      â”‚
â”‚ â”œâ”€ Supabase     â”‚ escrow_keys table
â”‚ â””â”€ localStorage â”‚ jobs array
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 8. Job created!
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard       â”‚
â”‚ Shows new job   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… Flow 2: Complete Job (Freelancer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Freelancer  â”‚
â”‚ Dashboard   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. View active job
       â”‚ 2. Click "Mark as Completed"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update Statusâ”‚
â”‚ PENDING â†’    â”‚
â”‚ COMPLETED    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Notify client
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client       â”‚
â”‚ Dashboard    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Review work
       â”‚ 5. Click "Approve & Release Funds"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ escrow.ts    â”‚
â”‚ releaseEscrowâ”‚
â”‚ Funds        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Retrieve escrow secret
       â”‚    - Try Supabase first
       â”‚    - Fallback to localStorage
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build Paymentâ”‚
â”‚ Transaction  â”‚
â”‚ - From: Escrow
â”‚ - To: Freelancer
â”‚ - Amount: Full
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Sign with escrow secret
       â”‚    (No wallet popup needed!)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stellar      â”‚
â”‚ Network      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 8. Payment executed
       â”‚    Funds transferred
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update Statusâ”‚
â”‚ COMPLETED â†’  â”‚
â”‚ APPROVED     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš–ï¸ Flow 3: Dispute Resolution (DAO)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client/      â”‚
â”‚ Freelancer   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Raise dispute
       â”‚    - Provide evidence
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ disputeStorageâ”‚
â”‚ .ts          â”‚
â”‚ saveDispute()â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Store in Supabase
       â”‚    disputes table
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Arbitrator   â”‚
â”‚ Dashboard    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. View dispute
       â”‚    - Client evidence
       â”‚    - Freelancer evidence
       â”‚    - Job details
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vote         â”‚
â”‚ - Client     â”‚
â”‚ - Freelancer â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Submit vote
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ addVoteToDisputeâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Store vote
       â”‚    votes array
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Votes  â”‚
â”‚ Count >= 3?  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. YES â†’ Resolve
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate    â”‚
â”‚ Winner       â”‚
â”‚ - Client: 1  â”‚
â”‚ - Freelancer:2â”‚
â”‚ Winner: FL   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Release funds to winner
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ releaseEscrowâ”‚
â”‚ Funds()      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 8. Payment to winner
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update Statusâ”‚
â”‚ DISPUTED â†’   â”‚
â”‚ RESOLVED     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. Wallet Security (Freighter)                         â”‚
â”‚     â”œâ”€ Private keys never leave wallet                  â”‚
â”‚     â”œâ”€ User approves each transaction                   â”‚
â”‚     â””â”€ Browser extension isolation                      â”‚
â”‚                                                          â”‚
â”‚  2. Escrow Security (Stellar Accounts)                  â”‚
â”‚     â”œâ”€ Funds locked in blockchain account               â”‚
â”‚     â”œâ”€ Secret key required to release                   â”‚
â”‚     â”œâ”€ Stored encrypted in Supabase                     â”‚
â”‚     â””â”€ Backup in localStorage                           â”‚
â”‚                                                          â”‚
â”‚  3. DAO Security (Voting)                               â”‚
â”‚     â”œâ”€ 3 votes required to resolve                      â”‚
â”‚     â”œâ”€ Arbitrators can't vote on own disputes           â”‚
â”‚     â”œâ”€ Majority wins (2 out of 3)                       â”‚
â”‚     â””â”€ Votes stored immutably in Supabase               â”‚
â”‚                                                          â”‚
â”‚  4. Data Security (Supabase)                            â”‚
â”‚     â”œâ”€ Row Level Security (RLS) policies                â”‚
â”‚     â”œâ”€ API keys in environment variables                â”‚
â”‚     â”œâ”€ HTTPS encryption in transit                      â”‚
â”‚     â””â”€ Database encryption at rest                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Sources                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Stellar Network (Source of Truth)                      â”‚
â”‚  â”œâ”€ Account balances                                    â”‚
â”‚  â”œâ”€ Transaction history                                 â”‚
â”‚  â””â”€ Escrow account states                               â”‚
â”‚                                                          â”‚
â”‚  Supabase (Persistent Storage)                          â”‚
â”‚  â”œâ”€ Disputes & votes                                    â”‚
â”‚  â”œâ”€ Escrow secrets (encrypted)                          â”‚
â”‚  â””â”€ Cross-browser sync                                  â”‚
â”‚                                                          â”‚
â”‚  localStorage (Local Cache)                             â”‚
â”‚  â”œâ”€ Jobs list                                           â”‚
â”‚  â”œâ”€ Escrow secrets (backup)                             â”‚
â”‚  â””â”€ Disputes (fallback)                                 â”‚
â”‚                                                          â”‚
â”‚  React Context (Runtime State)                          â”‚
â”‚  â”œâ”€ Wallet connection                                   â”‚
â”‚  â”œâ”€ Current jobs                                        â”‚
â”‚  â””â”€ Active disputes                                     â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ Network Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Network Topology                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Browser    â”‚
        â”‚   (Client)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Next.js Frontend           â”‚
        â”‚   (Vercel/Netlify)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                              â”‚
        â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stellar       â”‚            â”‚   Supabase      â”‚
â”‚ Horizon API   â”‚            â”‚   PostgreSQL    â”‚
â”‚ (Testnet)     â”‚            â”‚   (Cloud)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                              â”‚
        â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stellar Core  â”‚            â”‚  Database       â”‚
â”‚ (Blockchain)  â”‚            â”‚  - disputes     â”‚
â”‚               â”‚            â”‚  - escrow_keys  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ­ Actor Roles & Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Actors                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ‘” CLIENT                                               â”‚
â”‚  â”œâ”€ Create jobs                                         â”‚
â”‚  â”œâ”€ Fund escrow                                         â”‚
â”‚  â”œâ”€ Approve/reject work                                 â”‚
â”‚  â”œâ”€ Raise disputes                                      â”‚
â”‚  â””â”€ Release funds to freelancer                         â”‚
â”‚                                                          â”‚
â”‚  ğŸ’¼ FREELANCER                                           â”‚
â”‚  â”œâ”€ View available jobs                                 â”‚
â”‚  â”œâ”€ Mark work as completed                              â”‚
â”‚  â”œâ”€ Raise disputes                                      â”‚
â”‚  â””â”€ Receive payments                                    â”‚
â”‚                                                          â”‚
â”‚  âš–ï¸ ARBITRATOR (DAO Member)                             â”‚
â”‚  â”œâ”€ View disputes                                       â”‚
â”‚  â”œâ”€ Review evidence                                     â”‚
â”‚  â”œâ”€ Cast votes                                          â”‚
â”‚  â”œâ”€ Earn rewards (future)                               â”‚
â”‚  â””â”€ Cannot vote on own disputes                         â”‚
â”‚                                                          â”‚
â”‚  ğŸ¤– SYSTEM (Automated)                                   â”‚
â”‚  â”œâ”€ Count votes                                         â”‚
â”‚  â”œâ”€ Determine winner                                    â”‚
â”‚  â”œâ”€ Trigger fund release                                â”‚
â”‚  â””â”€ Update job statuses                                 â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š State Machine (Job Lifecycle)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Job State Machine                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    [START]
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PENDING â”‚ â† Job created, funds locked in escrow
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚ Freelancer marks complete
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ COMPLETED â”‚ â† Waiting for client review
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚        â”‚
    â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚APPROVED â”‚ â”‚ DISPUTED â”‚ â† Client rejects OR Freelancer disputes
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚
     â”‚            â”‚ DAO votes (3 votes)
     â”‚            â–¼
     â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚      â”‚ RESOLVED â”‚ â† Winner determined
     â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
              â–¼
         [FUNDS RELEASED]
              â”‚
              â–¼
            [END]
```

## ğŸ”§ Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tech Stack                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Frontend Framework                                      â”‚
â”‚  â””â”€ Next.js 15 (React 19, App Router)                   â”‚
â”‚                                                          â”‚
â”‚  Blockchain Integration                                  â”‚
â”‚  â”œâ”€ @stellar/stellar-sdk (v12.3.0)                      â”‚
â”‚  â”œâ”€ @stellar/freighter-api (v2.0.0)                     â”‚
â”‚  â””â”€ Stellar Testnet (horizon-testnet.stellar.org)       â”‚
â”‚                                                          â”‚
â”‚  UI/UX Libraries                                         â”‚
â”‚  â”œâ”€ Tailwind CSS (Styling)                              â”‚
â”‚  â”œâ”€ Framer Motion (Animations)                          â”‚
â”‚  â”œâ”€ Shadcn UI (Components)                              â”‚
â”‚  â””â”€ Geist Font (Typography)                             â”‚
â”‚                                                          â”‚
â”‚  Database & Storage                                      â”‚
â”‚  â”œâ”€ Supabase (PostgreSQL)                               â”‚
â”‚  â””â”€ localStorage (Browser cache)                        â”‚
â”‚                                                          â”‚
â”‚  State Management                                        â”‚
â”‚  â”œâ”€ React Context API                                   â”‚
â”‚  â””â”€ React Hooks (useState, useEffect)                   â”‚
â”‚                                                          â”‚
â”‚  Development Tools                                       â”‚
â”‚  â”œâ”€ TypeScript                                          â”‚
â”‚  â”œâ”€ ESLint                                              â”‚
â”‚  â””â”€ Git                                                 â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Deployment Topology                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel Edge Network                â”‚
â”‚                  (Global CDN - 70+ regions)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ Static Assets (JS, CSS, Images)                  â”‚
â”‚  â”œâ”€ Server-Side Rendering (SSR)                      â”‚
â”‚  â”œâ”€ API Routes (if needed)                           â”‚
â”‚  â””â”€ Automatic HTTPS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stellar       â”‚  â”‚  Supabase    â”‚
â”‚ Horizon API   â”‚  â”‚  (US/EU)     â”‚
â”‚ (Global)      â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Scalability Considerations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Scalability                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Current Limits:                                         â”‚
â”‚  â”œâ”€ Stellar: 1000+ TPS (transactions per second)        â”‚
â”‚  â”œâ”€ Supabase Free: 500MB database, 2GB bandwidth        â”‚
â”‚  â”œâ”€ localStorage: ~5-10MB per domain                    â”‚
â”‚  â””â”€ Vercel Free: 100GB bandwidth/month                  â”‚
â”‚                                                          â”‚
â”‚  Bottlenecks:                                            â”‚
â”‚  â”œâ”€ Supabase free tier limits                           â”‚
â”‚  â”œâ”€ localStorage size for large job lists               â”‚
â”‚  â””â”€ Client-side state management                        â”‚
â”‚                                                          â”‚
â”‚  Solutions:                                              â”‚
â”‚  â”œâ”€ Upgrade Supabase plan ($25/month)                   â”‚
â”‚  â”œâ”€ Implement pagination for jobs                       â”‚
â”‚  â”œâ”€ Add caching layer (Redis)                           â”‚
â”‚  â””â”€ Move to server-side state management                â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Key Design Decisions

1. **No Smart Contract Deployment**
   - Uses Stellar's native account system
   - Simpler than Soroban contracts
   - Lower gas fees

2. **Hybrid Storage**
   - Supabase for cross-browser sync
   - localStorage for offline capability
   - Stellar for source of truth

3. **Client-Side Logic**
   - No backend server needed
   - Direct blockchain interaction
   - Faster user experience

4. **DAO Voting**
   - Simple majority (2/3 votes)
   - Prevents self-voting
   - Automated fund release

5. **Escrow Secret Storage**
   - Dual storage (Supabase + localStorage)
   - Enables cross-browser access
   - Backup redundancy

## ğŸ”® Future Enhancements

- [ ] Soroban smart contract integration
- [ ] IPFS for evidence storage
- [ ] Reputation system for arbitrators
- [ ] Staking mechanism for DAO
- [ ] Multi-currency support
- [ ] Mobile app (React Native)
- [ ] Real-time notifications
- [ ] Advanced analytics dashboard

---

**Architecture Version:** 1.0  
**Last Updated:** October 2024  
**Network:** Stellar Testnet  
**Status:** Production Ready âœ…
